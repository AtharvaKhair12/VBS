<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="VBS Secure Passbook - A digital ledger providing a real-time, high-speed audit of all deposits, withdrawals, and transfers within the Virtual Banking System.">
    <title>VBS Passbook | Secure Digital Ledger</title>

    <style>
        /* --- BRANDING: VBS SLATE & COBALT --- */
        :root {
            --vbs-primary: #0f172a;    /* High-contrast Slate */
            --vbs-accent: #3b82f6;     /* Cobalt Blue */
            --vbs-success: #10b981;    /* Accessible Emerald */
            --vbs-danger: #ef4444;     /* Accessible Red */
            --vbs-info: #0ea5e9;       /* Light Blue for Transfers */
            --vbs-bg: #f8fafc;
            --vbs-white: #ffffff;
            --vbs-text: #1e293b;
            --vbs-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', 'Segoe UI', system-ui, sans-serif;
            background-color: var(--vbs-bg);
            color: var(--vbs-text);
            line-height: 1.5;
            min-height: 100vh;
            padding: 1.5rem;
        }

        /* Semantic Layout */
        .vbs-main-container {
            max-width: 1000px;
            margin: auto;
            background: var(--vbs-white);
            border-radius: 1rem;
            box-shadow: var(--vbs-shadow);
            overflow: hidden;
            border-top: 5px solid var(--vbs-accent);
        }

        /* Semantic Header */
        header {
            background: var(--vbs-primary);
            padding: 2rem;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1.5rem;
        }

        header h1 { font-size: 1.75rem; font-weight: 800; letter-spacing: -0.025em; }
        header h1 span { color: var(--vbs-accent); }

        .btn-group { display: flex; gap: 0.75rem; }

        .btn-nav {
            padding: 0.625rem 1.25rem;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: 0.2s;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
        }

        .btn-nav:hover { background: var(--vbs-accent); border-color: var(--vbs-accent); }
        .btn-logout:hover { background: var(--vbs-danger); border-color: var(--vbs-danger); }

        main { padding: 2.5rem 2rem; }

        .ledger-summary {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 2.5rem;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 1.5rem;
        }

        .ledger-summary h2 { font-size: 1.5rem; color: var(--vbs-primary); font-weight: 700; }

        .balance-indicator {
            background: var(--vbs-primary);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 0.75rem;
            text-align: right;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }

        .balance-indicator p { font-size: 0.75rem; text-transform: uppercase; font-weight: 700; opacity: 0.8; letter-spacing: 0.05em; }
        .balance-indicator .amount { font-size: 1.75rem; font-weight: 800; color: var(--vbs-accent); margin-top: 0.25rem; }

        /* Transaction List Styling */
        .transactions-outer {
            background: #f1f5f9;
            padding: 1.5rem;
            border-radius: 0.75rem;
        }

        .transaction-card {
            background: white;
            padding: 1.25rem;
            border-radius: 0.75rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            border-left: 6px solid var(--vbs-accent);
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: transform 0.2s;
        }

        .transaction-card:hover { transform: scale(1.01); }

        /* Accessible Indicators */
        .transaction-card.deposit { border-left-color: var(--vbs-success); }
        .transaction-card.withdrawal { border-left-color: var(--vbs-danger); }
        .transaction-card.transfer { border-left-color: var(--vbs-info); }

        .card-left { display: flex; gap: 1rem; align-items: center; }

        .icon-circle {
            width: 48px; height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .deposit .icon-circle { background: #dcfce7; color: var(--vbs-success); }
        .withdrawal .icon-circle { background: #fee2e2; color: var(--vbs-danger); }
        .transfer .icon-circle { background: #e0f2fe; color: var(--vbs-info); }

        .details .type-desc { font-weight: 700; color: var(--vbs-primary); font-size: 1rem; }
        .details .timestamp { font-size: 0.75rem; color: #64748b; margin-top: 0.25rem; }

        .card-right { text-align: right; }

        .trans-amount { font-size: 1.125rem; font-weight: 800; }
        .deposit .trans-amount { color: var(--vbs-success); }
        .withdrawal .trans-amount { color: var(--vbs-danger); }
        .transfer .trans-amount { color: var(--vbs-info); }

        .post-balance { font-size: 0.75rem; color: #64748b; margin-top: 0.25rem; font-weight: 600; }

        /* SEO Friendly Pagination */
        .pagination-area {
            margin-top: 2rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
        }

        .pagination-area button {
            padding: 0.5rem 1rem;
            border: 1px solid #cbd5e1;
            background: white;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            color: var(--vbs-primary);
            transition: 0.2s;
        }

        .pagination-area button.active {
            background: var(--vbs-primary);
            color: white;
            border-color: var(--vbs-primary);
        }

        .pagination-area button:hover:not(.active) { background: #f1f5f9; }

        @media (max-width: 640px) {
            header { padding: 1.5rem; }
            .ledger-summary { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .balance-indicator { width: 100%; text-align: left; }
            .transaction-card { flex-direction: column; align-items: flex-start; gap: 1rem; }
            .card-right { text-align: left; width: 100%; padding-left: 4rem; }
        }
    </style>
</head>

<body>
<div class="vbs-main-container">

    <header>
        <div class="logo">
            <h1>VBS <span>PASSBOOK</span></h1>
        </div>
        <nav class="btn-group">
            <a id="dashLink" class="btn-nav">‚Üê Return to Dashboard</a>
            <button class="btn-nav btn-logout" onclick="logout()">System Logout</button>
        </nav>
    </header>

    <main>
        <section class="ledger-summary">
            <div>
                <h2>Secure Digital Ledger</h2>
                <p style="color: #64748b; font-size: 0.875rem;">Authentication Verified Transaction Audit</p>
            </div>
            <div class="balance-indicator">
                <p>Verified Net Balance</p>
                <div class="amount">‚Çπ<span id="currentBalance">0.00</span></div>
            </div>
        </section>

        <section class="transactions-outer">
            <div id="transactionsList" class="transactions-list">
            </div>
            <div id="paginationControls" class="pagination-area"></div>
        </section>
    </main>

</div>

<script>
    /* --- STRICT VBS BACKEND LOGIC PRESERVATION --- */
    const API_URL = 'http://localhost:8081';
    let userId, role;
    let transactions = [];
    let currentPage = 1;
    const itemsPerPage = 10;

    function getUserIdFromURL(){
        const p = new URLSearchParams(window.location.search);
        userId = p.get('id');
        role = p.get('role') || 'customer';
        if(!userId) location.href='login.html';
        document.getElementById('dashLink').href =
            `dashboard.html?id=${userId}&role=${encodeURIComponent(role)}`;
    }

    async function loadPassbook(){
        try {
            const r = await fetch(`${API_URL}/passbook/${userId}`);
            transactions = await r.json();
            if(transactions.length)
                document.getElementById('currentBalance').textContent =
                    transactions[transactions.length-1].currBalance.toFixed(2);
            render();
        } catch (error) {
            console.error("VBS Data Sync Error:", error);
        }
    }

    function getType(d){
        d=d.toLowerCase();
        if(d.includes('deposit')) return 'deposit';
        if(d.includes('withdrawal')) return 'withdrawal';
        return 'transfer';
    }

    function render(){
        const list = document.getElementById('transactionsList');
        const pag = document.getElementById('paginationControls');

        const sorted=[...transactions].sort((a,b)=>new Date(b.date)-new Date(a.date));
        const totalPages=Math.ceil(sorted.length/itemsPerPage);
        const slice=sorted.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);

        if (slice.length === 0) {
            list.innerHTML = '<div style="text-align:center; padding: 2rem; color: #64748b; font-weight:600;">No ledger entries found for this authentication ID.</div>';
            return;
        }

        list.innerHTML=slice.map(t=>{
            const type = getType(t.description);
            let sign = '-';
            if(type === 'deposit') sign = '+';
            else if(type === 'transfer' && t.description.toLowerCase().includes('received'))
                sign = '+';

            const icon = type==='deposit'?'üì•':type==='withdrawal'?'üí∏':'üîÅ';

            return `
            <article class="transaction-item transaction-card ${type}">
                <div class="card-left">
                    <div class="icon-circle" aria-hidden="true">${icon}</div>
                    <div class="details">
                        <div class="type-desc">${t.description}</div>
                        <div class="timestamp">${new Date(t.date).toLocaleString('en-IN', { dateStyle: 'medium', timeStyle: 'short' })}</div>
                    </div>
                </div>
                <div class="card-right">
                    <div class="trans-amount" aria-label="Amount">${sign}‚Çπ${t.amount.toFixed(2)}</div>
                    <div class="post-balance">Balance ‚Çπ${t.currBalance.toFixed(2)}</div>
                </div>
            </article>`;
        }).join('');

        pag.innerHTML='';
        if (totalPages > 1) {
            for(let i=1;i<=totalPages;i++){
                pag.innerHTML+=`<button class="${i===currentPage?'active':''}" onclick="go(${i})">${i}</button>`;
            }
        }
    }

    function go(p){currentPage=p;render()}
    function logout(){location.href='home.html'}

    window.onload=()=>{
        getUserIdFromURL();
        loadPassbook();
    }
</script>
</body>
</html>